@model IEnumerable<ColmanWebProject.Models.Store>

@{
    ViewData["Title"] = "ShowStores";

}

@*<script src="~/js/stores.js"></script>
    <div id="storesMap" ></div>*@

﻿
@*<!DOCTYPE html>
    <html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <script type='text/javascript'>
            function GetMap() {
                var map = new Microsoft.Maps.Map('#myMap', getLocationsFromModelRequests());

                //Request the user's location
                navigator.geolocation.getCurrentPosition(function (position) {
                    var loc = new Microsoft.Maps.Location(
                        position.coords.latitude,
                        position.coords.longitude);

                    //Add a pushpin at the user's location.
                    var pin = new Microsoft.Maps.Pushpin(loc);
                    map.entities.push(pin);

                    //Center the map on the user's location.
                    map.setView({ center: loc, zoom: 15 });
                });
            }

            function getLocationsFromModelRequests() {
                var requestData = [];
                @foreach (var request in ViewBag.Stores)
                {
                    @:var reqData = {lat:@request.Latitude, long:@request.Lontitude, open:'@request.OpeningHour',close:'@request.ClosingHour', color:'blue'};

                        @:reqData.color = 'green';


                    @:requestData.push(reqData);
                }
                return requestData;
            }
        </script>
        <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=[ApDDnnOtsh8YyRnlGb0TzW2VYvZnGzxVF7es5LUFydQw4KAomu5_cQhYvlwugfPG]' async defer></script>
    </head>
    <body>
        @if(ViewBag.Stores != null)
                {

                }
        <div id="myMap" stores=@ViewBag.Stores style="position:relative;width:800px;height:600px;"></div>
    </body>
    </html>*@


<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <script type='text/javascript'>

        function loadMapScenario() {
        // var map = new Microsoft.Maps.Map('#myMap', getLocationsFromModelRequests());
        var map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
            credentials: 'ApDDnnOtsh8YyRnlGb0TzW2VYvZnGzxVF7es5LUFydQw4KAomu5_cQhYvlwugfPG',
            mapTypeId: Microsoft.Maps.MapTypeId.road,
            zoom: 10
        });
            var center = map.getCenter();

            //Create custom Pushpin
            var pin = new Microsoft.Maps.Pushpin(center, {
                title: 'Microsoft',
                subTitle: 'City Center',
                text: '1'
            });

            //Add the pushpin to the map
            map.entities.push(pin);

        // Create the infobox for the pushpin
        var infobox = null;

        //declare addMarker function
        function addMarker(latitude, lontitude, OpeningHour, ClosingHour, pid)
        {
           // var center = map.getCenter();

            //Create custom Pushpin
            var pin = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(latitude, lontitude), {
                title: 'Colmun Music Store',
                subTitle: 'Opening Hours: ' + OpeningHour + "-" + ClosingHour,
                text: ''
            });

            //Add the pushpin to the map
            map.entities.push(pin);

           // var marker = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(latitude, lontitude), { color: 'green' });

        //    infobox = new Microsoft.Maps.Infobox(marker.getLocation(), {
        //        visible : false
        //    });

        //    marker.metadata = {
        //        id: pid,
        //        //title: title,
        //        description: OpeningHour + '--' + ClosingHour
        //    };

        //    Microsoft.Maps.Events.addHandler(marker, 'mouseout', hideInfobox);
        //    Microsoft.Maps.Events.addHandler(marker, 'mouseover', showInfobox);

        //    infobox.setMap(map);
        //    map.entities.push(marker);
        //    marker.setOptions({ enableHoverStyle: true });
        //};

        //function showInfobox(e) {
        //    if (e.target.metadata) {
        //        infobox.setOptions({
        //            location: e.target.getLocation(),
        //            //title: e.target.metadata.title,
        //            description: e.target.metadata.description,
        //            visible: true
        //        });
        //    }
        }

        function hideInfobox(e) {
            infobox.setOptions({ visible: false });
        }

        //add markers to map
        @if(ViewBag.Stores != null)
        {
            foreach (var item in ViewBag.Stores)
            {
                @:addMarker(@item.Latitude, @item.Lontitude, '@item.OpeningHour', '@item.ClosingHour', @item.Id);
            }
        }

    }
    </script>
    <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?branch=release&callback=loadMapScenario' async defer></script>
</head>
<body>
 
                <h1 class="modal-title" id="addPositionsLabel">Our Stores</h1>
             
                <div class="row">
                    <div class="col-md-12 map">
                        <div id="myMap" style="width:100%; height:610px;"></div>
                    </div>
                </div>
      
</body>
</html>